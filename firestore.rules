service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      allow read;
      allow write: if request.auth.uid == userId;
      match /{document=**} {
      	allow read;
        allow write: if request.auth.uid == userId;
    	}
    }
    match /pages/{pageId} {
      allow read: if resource.data.isDraft == false || (resource.data.ownerId == request.auth.uid && resource.data.ownerType == 'user');
      allow create: if request.auth.uid != null;
      allow update, delete: if resource.data.ownerId == request.auth.uid && resource.data.ownerType == 'user';
      match /{document=**} {
    		allow read: if get(/databases/$(database)/documents/pages/$(pageId)).data.isDraft == false || (get(/databases/$(database)/documents/pages/$(pageId)).data.ownerId == request.auth.uid && get(/databases/$(database)/documents/pages/$(pageId)).data.ownerType == 'user');
        allow create: if request.auth.uid != null;
      	allow update, delete: if get(/databases/$(database)/documents/pages/$(pageId)).data.ownerId == request.auth.uid && get(/databases/$(database)/documents/pages/$(pageId)).data.ownerType == 'user';
    	}
    }
  }
}